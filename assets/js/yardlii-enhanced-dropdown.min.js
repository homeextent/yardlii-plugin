jQuery(function($){console.log("Yardlii Enhanced Dropdown loaded");
const dropdown=$("select#group");if(!dropdown.length)return;const wrapper=$('<div class="yardlii-enhanced-dropdown"></div>');
dropdown.hide().after(wrapper);const parentMap={};dropdown.find("option").each(function(){const t=$(this),txt=t.text().trim(),val=t.val(),lvl=t.attr("class")||"level-0";if(val==-1)return;
if(lvl.includes("level-0")){parentMap[val]={text:txt,children:[]}}else if(lvl.includes("level-1")){const pval=t.prevAll("option.level-0:first").val();if(pval&&parentMap[pval])parentMap[pval].children.push({text:txt,value:val})}});
$.each(parentMap,function(pval,pdata){const p=$('<div class="dropdown-item parent" data-value="'+pval+'">'+pdata.text+"</div>");const c=$('<div class="child-container"></div>');
pdata.children.forEach(ch=>c.append('<div class="dropdown-item child" data-value="'+ch.value+'">'+ch.text+"</div>"));wrapper.append(p).append(c)});
$(".dropdown-item.parent").on("click touchstart",function(e){e.stopPropagation();const p=$(this),c=p.next(".child-container"),open=p.hasClass("expanded");
$(".dropdown-item.parent.expanded").not(p).removeClass("expanded").next(".child-container").slideUp(200);
if(open){p.removeClass("expanded");c.slideUp(200)}else{const vh=$(window).height(),r=p[0].getBoundingClientRect(),below=vh-r.bottom,h=c.outerHeight()||200,u=below<h;
c.removeClass("open-up open-down").addClass(u?"open-up":"open-down");
p.addClass("expanded");c.slideDown(220)}});$(".dropdown-item.child").on("click touchstart",function(e){e.stopPropagation();
const v=$(this).data("value"),t=$(this).text();dropdown.val(v).trigger("change");wrapper.find(".dropdown-item.child").removeClass("selected");
$(this).addClass("selected");$(".dropdown-item.parent.expanded").removeClass("expanded").next(".child-container").slideUp(150)});
$(document).on("click touchstart",function(e){if(!$(e.target).closest(".yardlii-enhanced-dropdown").length)
$(".dropdown-item.parent.expanded").removeClass("expanded").next(".child-container").slideUp(150)});
$(window).on("resize orientationchange",function(){$(".yardlii-enhanced-dropdown .dropdown-item.parent.expanded").each(function(){const p=$(this),c=p.next(".child-container"),vh=$(window).height(),r=p[0].getBoundingClientRect(),below=vh-r.bottom,h=c.outerHeight()||200,u=below<h;c.removeClass("open-up open-down").addClass(u?"open-up":"open-down")})})});
